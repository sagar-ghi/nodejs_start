var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,o=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&n(e,a,t[a]);if(s)for(var a of s(t))r.call(t,a)&&n(e,a,t[a]);return e},c=(e,s)=>t(e,a(s));import{_ as i,r as d,R as u,C as p,a as m,b as g,A as f,B as h,S as v,L as b,D as E,c as y,P as w,d as k,e as x,f as I,N as $,g as _,h as D}from"./vendor.90f47876.js";const P="http://localhost:7000",S=[{name:"Backlog",color:"Dark",emoji:"ðŸš©"},{name:"Progress",color:"Info",emoji:"ðŸ¤ž"},{name:"Completed",color:"Success",emoji:"ðŸ¤˜"}],j={create:null,get:null,update:null,delete:null};function C(){i();const[e,t]=d.exports.useState([[],[],[]]),[a,s]=d.exports.useState(!1),[l,r]=d.exports.useState(null),[n,$]=d.exports.useState(!1),[_,D]=d.exports.useState(j),[C,N]=d.exports.useState(!1);async function O(){var a,s,l,n;try{let a=[...e];const{data:s}=await x.get(`${P}/tasks`);return a=s.reduce(((e,t)=>("backlog"===t.state?e[0].push(t):"completed"===t.state?e[2].push(t):e[1].push(t),e)),[[],[],[]]),t(a),[a,null]}catch(o){return r(null==(s=null==(a=null==o?void 0:o.response)?void 0:a.data)?void 0:s.message),[null,null==(n=null==(l=null==o?void 0:o.response)?void 0:l.data)?void 0:n.message]}}async function L(e,t){var a,s,l,n;try{const{data:a}=await x.put(`${P}/tasks/${e}`,{state:t});return[null,a]}catch(o){return r(null==(s=null==(a=null==o?void 0:o.response)?void 0:a.data)?void 0:s.message),[null==(n=null==(l=null==o?void 0:o.response)?void 0:l.data)?void 0:n.message,null]}}u.useEffect((()=>{O()}),[]),u.useEffect((()=>{C&&setTimeout((()=>{N(!1)}),7e3)}),[!!C]),u.useEffect((()=>{!async function(){if(n&&e[2].length>1){const t=e[2].find((e=>!e.isValid));await x.put(`${P}/tasks/${null==t?void 0:t._id}`,{state:"completed"}),A()}}()}),[e]),u.useEffect((()=>{n||setTimeout((()=>{D(j)}),5e3)}),[n]);const A=async()=>{let a=o({},_),s=e.flat();try{for await(let e of s){const{data:s}=await x.delete(`${P}/tasks/${e._id}`);1!==(null==s?void 0:s.deletedCount)&&D(c(o({},a),{delete:"failed"})),t([[],[],[]]),D(c(o({},a),{delete:"success"})),$(!1),N(!0),$(!1)}}catch(l){console.log(l),D(c(o({},a),{delete:"failed"})),r(l),$(!1)}},T=d.exports.useCallback((async function(a){const{source:s,destination:l}=a;if(!l)return;const r=+s.droppableId,o=+l.droppableId;if(r===o){const a=((e,t,a)=>{const s=Array.from(e),[l]=s.splice(t,1);return s.splice(a,0,l),s})(e[r],s.index,l.index),n=[...e];n[r]=a,t(n)}else{const a="0"==o?"backlog":"1"==o?"progress":"completed",i=((e,t,a,s)=>{const l="0"==s.index?"backlog":"1"==s.index?"progress":"completed",r=Array.from(e),n=Array.from(t),[o]=r.splice(a.index,1);n.splice(s.index,0,o);const c={};return c[a.droppableId]=r,c[s.droppableId]=n,c[s.droppableId][a.index].state=l,c})(e[r],e[o],s,l),d=[...e];if(d[r]=i[r],d[o]=i[o],t(d),!n)try{const{data:t}=await L(e[parseInt(r)][s.index]._id,a)}catch(c){console.log(c.response),t([...e])}}}));function B(e,t=800){return new Promise((a=>{setTimeout((()=>{e(),a()}),t)}))}function R(){}const z=e=>null===_[e]?"/assets/default.98e96685.svg":"success"===_[e]?"/assets/success.ed4464d9.svg":"/assets/failed.c8b2404f.svg";return u.createElement("div",{style:{display:"grid",placeItems:"center"}},u.createElement(p,{width:1400,height:700,run:C}),u.createElement(m,null,u.createElement(g,null,!!l&&u.createElement(f,{variant:"danger",className:"p-1 mt-5"},l),u.createElement(h,{className:"btn btn-info mt-5",size:"sm",onClick:async()=>{var a,l,n,i;let d=o({},_);try{$(!0);let a=[...e];try{for await(let s of a.flat()){let a=[...e];const{data:l}=await x.delete(`${P}/tasks/${s._id}`);let r=a.flat();a=r.filter((e=>e._id!==s._id)).reduce(((e,t)=>("backlog"===t.state?e[0].push(t):"completed"===t.state?e[2].push(t):e[1].push(t),e)),[[],[],[]]),t(a)}a=[[],[],[]]}catch(u){return r("Error clearing the database"),$(!0)}const s=((e,t=0)=>Array.from({length:e},((e,t)=>t)).map((e=>({id:`item-${e+t}-${(new Date).getTime()}`,description:I.commerce.productDescription(),title:I.commerce.product(),state:"backlog"}))))(3);for await(let e of s){const{data:t}=await x.post(`${P}/tasks`,e);a[0].push(t)}a.length>0&&(d=c(o({},d),{create:"success"}),D(d),t(a))}catch(u){console.log(u),d=c(o({},d),{create:"failed"}),D(d),r(null==(l=null==(a=null==u?void 0:u.response)?void 0:a.data)?void 0:l.message),$(!1)}try{const[e]=await O();e.length>0?(d=c(o({},d),{get:"success"}),D(d)):(d=c(o({},d),{get:"failed"}),D(d))}catch(u){d=c(o({},d),{get:"failed"}),D(d),r(null==(i=null==(n=null==u?void 0:u.response)?void 0:n.data)?void 0:i.message),$(!1)}try{s(!0)}catch(u){}},disabled:!!n},n&&u.createElement(v,{as:"span",animation:"grow",size:"sm",role:"status","aria-hidden":"true"}),"Run Test"),u.createElement(b,{className:"mt-3"},u.createElement(b.Item,null),u.createElement(b.Item,null,u.createElement("img",{src:z("create"),alt:"",height:"25px"})," Create tasks"),u.createElement(b.Item,null,u.createElement("img",{src:z("get"),alt:"",height:"25px"})," Get tasks"),u.createElement(b.Item,null,u.createElement("img",{src:z("update"),alt:"",height:"25px"})," Update tasks"),u.createElement(b.Item,null,u.createElement("img",{src:z("delete"),alt:"",height:"25px"})," Delete tasks"))),u.createElement(g,null,u.createElement("div",{style:{display:"flex"}},u.createElement(E,{onDragEnd:T,sensors:[l=>function(l){const r=d.exports.useCallback((async function(){var r;let n=null==(r=e[0][0])?void 0:r._id;if(!n||e[2].length>0||!a)return;let i=o({},_);const d=l.tryGetLock(n,R);if(!d)return void console.warn("unable to start drag");const u=d.snapLift(),{moveDown:p,moveUp:m,drop:g,moveLeft:f,moveRight:h}=u;await B(p),await B(p),await B(p),await B(m),await B(h);const[v,b]=await L(n,"progress");if(v)return await B(f),i=c(o({},i),{update:"failed"}),D(i),s(!1);if(b){let a=[...e];const s=a.flat(),l=s.findIndex((e=>e._id===n));if("backlog"===s[l].state&&"progress"===b.state){if(e[2].length>0)return await B(g);s[l]=b,a=s.reduce(((e,t)=>("backlog"===t.state?e[0].push(t):"completed"===t.state?e[2].push(t):e[1].push(t),e)),[[],[],[]]),t(a),i=c(o({},i),{update:"success"}),D(i)}else i=c(o({},i),{update:"failed"}),D(i)}await B(h);const[E,y]=await L(n,"completed");if(E)return await B(f),i=c(o({},i),{update:"failed"}),D(i),s(!1);if(y){let a=[...e];const s=a.flat(),l=s.findIndex((e=>e._id===n));"progress"!==s[l].state&&"backlog"!==s[l].state||"completed"!==y.state?(console.log("error here"),i=c(o({},i),{update:"failed"}),D(i)):(s[l]=y,a=s.reduce(((e,t)=>("backlog"===t.state?e[0].push(t):"completed"===t.state?e[2].push(c(o({},t),{isValid:!0})):e[1].push(t),e)),[[],[],[]]),t(a),i=c(o({},i),{update:"success"}),D(i))}await B(g),s(!1)}),[l,a]);d.exports.useEffect((()=>{r()}),[r,a])}(l)]},null==e?void 0:e.map(((a,s)=>u.createElement("div",{key:s},u.createElement("h3",{className:"ml-5 p-3"},S[s].name),u.createElement(y,{key:s,droppableId:`${s}`},((l,r)=>{return u.createElement("div",o({ref:l.innerRef,style:(n=r.isDraggingOver,{background:n?"lightblue":"",padding:8,width:320,border:"1px solid lightgrey",marginLeft:20,minHeight:600,maxHeight:900,overflow:"scroll",overflowX:"hidden"})},l.droppableProps),a.map(((a,l)=>u.createElement(w,{key:a._id,draggableId:a._id,index:l,isDragDisabled:2===parseInt(s)},((l,r)=>{return u.createElement("div",c(o(o({ref:l.innerRef},l.draggableProps),l.dragHandleProps),{style:(n=r.isDragging,i=l.draggableProps.style,o({userSelect:"none",margin:"0 0 8px 0",background:n?"lightgreen":"grey"},i))}),u.createElement(k,{bg:S[s].color.toLowerCase(),key:s,text:"light"===S[s].color.toLowerCase()?"dark":"white",style:{width:"18rem"},className:"mb-2"},u.createElement(k.Header,{className:"d-flex"},a.title,u.createElement(h,{variant:"warning",style:{marginLeft:10},size:"sm",onClick:()=>(async a=>{let s=[...e];await x.delete(`${P}/tasks/${a}`);let l=s.flat();s=l.filter((e=>e._id!==a)).reduce(((e,t)=>("backlog"===t.state?e[0].push(t):"completed"===t.state?e[2].push(t):e[1].push(t),e)),[[],[],[]]),t(s)})(a._id)},"Delete")),u.createElement(k.Body,null,u.createElement(k.Text,{style:{fontWeight:"300",fontSize:"15px"}},a.description))));var n,i})))),l.placeholder);var n}))))))))))}function N(){return u.createElement("div",{className:"App"},u.createElement("header",{className:"App-header"},u.createElement($,{bg:"dark",variant:"dark"},u.createElement(_,null,u.createElement($.Brand,{href:"#home"},u.createElement("img",{alt:"",src:"/assets/github.d20f6d75.svg",width:"30",height:"30",className:"d-inline-block align-top"})," ","To-do list"))),u.createElement(C,null)))}D.render(u.createElement(u.StrictMode,null,u.createElement(N,null)),document.getElementById("root"));
